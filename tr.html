<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <title>Girly Zone Order Management</title>
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: 'Segoe UI', sans-serif;
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  background-color: #fff0f5;
Â  Â  }

Â  Â  header.main-header {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  padding: 20px;
Â  Â  Â  background: linear-gradient(to right, #f78da7, #d63384);
Â  Â  Â  flex-wrap: wrap;
Â  Â  }

Â  Â  .logo-image {
Â  Â  Â  width: 80px;
Â  Â  Â  height: 80px;
Â  Â  Â  object-fit: cover;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  border: 3px solid white;
Â  Â  Â  box-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
Â  Â  }

Â  Â  .site-title {
Â  Â  Â  font-size: 2rem;
Â  Â  Â  color: white;
Â  Â  Â  margin-left: 15px;
Â  Â  Â  flex: 1;
Â  Â  Â  min-width: 200px;
Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  h2, h3 {
Â  Â  Â  text-align: center;
Â  Â  Â  color: #d63384;
Â  Â  Â  margin-top: 20px;
Â  Â  }

Â  Â  input[type="text"], input[type="file"], input[type="number"], input[type="password"] {
Â  Â  Â  padding: 8px;
Â  Â  Â  margin: 5px 0;
Â  Â  Â  display: block;
Â  Â  Â  width: 90%;
Â  Â  Â  max-width: 300px;
Â  Â  }

Â  Â  button {
Â  Â  Â  padding: 8px 12px;
Â  Â  Â  margin: 10px 5px 20px 0;
Â  Â  Â  background-color: #f57e92;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  color: white;
Â  Â  }

Â  Â  button:hover {
Â  Â  Â  background-color: #d63384;
Â  Â  }

Â  Â  table {
Â  Â  Â  width: 95%;
Â  Â  Â  margin: auto;
Â  Â  Â  border-collapse: collapse;
Â  Â  Â  background: white;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
Â  Â  }

Â  Â  th, td {
Â  Â  Â  padding: 12px;
Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  img {
Â  Â  Â  max-width: 100px;
Â  Â  Â  border-radius: 5px;
Â  Â  }

Â  Â  .form-container {
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  }

Â  Â  #auth-section {
Â  Â  Â  text-align: center;
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  padding: 20px;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  max-width: 400px;
Â  Â  Â  margin-left: auto;
Â  Â  Â  margin-right: auto;
Â  Â  }
Â  Â  .hidden {
Â  Â  Â  display: none;
Â  Â  }
Â  Â  #user-status {
Â  Â  Â  margin: 10px;
Â  Â  Â  color: #555;
Â  Â  }
Â  </style>
</head>
<body>
Â  <header class="main-header">
Â  Â  <div class="logo-container">
Â  Â  Â  <img src="logo.jpg" alt="Logo" class="logo-image" />
Â  Â  </div>
Â  Â  <h1 class="site-title">The Girly Zone - Order Management</h1>
Â  </header>

Â  <div id="auth-section">
Â  Â  <h3>Log In to Manage Products</h3>
Â  Â  <button id="google-login-btn">Sign In with Google</button>
Â  Â  <button id="logout-btn" class="hidden">Log Out</button>
Â  Â  <div id="user-status"></div>
Â  </div>

Â  <h2>Search by Serial Number</h2>
Â  <div class="form-container">
Â  Â  <input type="text" id="searchInput" placeholder="Enter serial number..."/>
Â  </div>

Â  <div id="add-product-section" class="hidden">
Â  Â  <h3>Add New Entry</h3>
Â  Â  <div class="form-container">
Â  Â  Â  <input type="text" id="newSerial" placeholder="Enter serial number"/>
Â  Â  Â  <input type="file" id="newImage" accept="image/*"/>
Â  Â  Â  <input type="number" id="newPrice" placeholder="Enter price"/>
Â  Â  Â  <button id="addBtn">Add to supabase</button>
Â  Â  </div>
Â  </div>

Â  <table id="imageTable">
Â  Â  <thead>
Â  Â  Â  <tr>
Â  Â  Â  Â  <th>Serial Number</th>
Â  Â  Â  Â  <th>Image</th>
Â  Â  Â  Â  <th>Price</th>
Â  Â  Â  Â  <th>Action</th>
Â  Â  Â  </tr>
Â  Â  </thead>
Â  Â  <tbody></tbody>
Â  </table>

Â  
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
Â  Â  // Replace with your actual Supabase URL and Anon Key
Â  Â  const SUPABASE_URL = 'https://paejmdjjolulejdjijjx.supabase.co';
Â  Â  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBhZWptZGpqb2x1bGVqZGppamp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczMjA1MDIsImV4cCI6MjA3Mjg5NjUwMn0.uPFR1pb2Tt3-slJ53-Y7nDt9sjoHFEr2WrWfxOyF3Zo';
Â  Â  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
Â  Â  const auth = supabase.auth;

Â  Â  const BUCKET_NAME = "images";
Â  Â  
Â  Â  // UI Elements
Â  Â  const googleLoginBtn = document.getElementById("google-login-btn");
Â  Â  const logoutBtn = document.getElementById("logout-btn");
Â  Â  const addProductSection = document.getElementById("add-product-section");
Â  Â  const userStatusDiv = document.getElementById("user-status");
Â  Â  const tableBody = document.querySelector("#imageTable tbody");
Â  Â  const searchInput = document.getElementById("searchInput");
Â  Â  const addBtn = document.getElementById("addBtn");

Â  Â  // Event Listeners
Â  Â  searchInput.addEventListener("input", (e) => {
Â  Â  Â  loadProducts(e.target.value);
Â  Â  });

Â  Â  addBtn.addEventListener("click", () => {
Â  Â  Â  const serial = document.getElementById("newSerial").value;
Â  Â  Â  const price = document.getElementById("newPrice").value;
Â  Â  Â  const imageFile = document.getElementById("newImage").files[0];
Â  Â  Â  
Â  Â  Â  const productData = {
Â  Â  Â  Â  serial_number: serial,
Â  Â  Â  Â  price: price,
Â  Â  Â  Â  image_url: imageFile,
Â  Â  Â  };

Â  Â  Â  addNewProduct(productData);
Â  Â  });

Â  Â  // Handle Google Sign-in
Â  Â  googleLoginBtn.addEventListener("click", async () => {
Â  Â  Â  try {
Â  Â  Â  Â  const { error } = await supabase.auth.signInWithOAuth({
Â  Â  Â  Â  Â  provider: 'google',
Â  Â  Â  Â  });
Â  Â  Â  Â  if (error) throw error;
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Google login error: ", error);
Â  Â  Â  Â  alert(`âŒ Google login failed: ${error.message}`);
Â  Â  Â  }
Â  Â  });

Â  Â  // Handle Sign-out
Â  Â  logoutBtn.addEventListener("click", async () => {
Â  Â  Â  try {
Â  Â  Â  Â  const { error } = await supabase.auth.signOut();
Â  Â  Â  Â  if (error) throw error;
Â  Â  Â  Â  alert("âœ… Logged out successfully!");
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Log out error: ", error);
Â  Â  Â  Â  alert(`âŒ Log out failed: ${error.message}`);
Â  Â  Â  }
Â  Â  });

Â  Â  // Auth state listener to update the UI
Â  Â  supabase.auth.onAuthStateChange((event, session) => {
Â  Â  Â  const user = session?.user;
Â  Â  Â  if (user) {
Â  Â  Â  Â  userStatusDiv.textContent = `Logged in as: ${user.email || user.user_metadata.full_name}`;
Â  Â  Â  Â  logoutBtn.classList.remove("hidden");
Â  Â  Â  Â  googleLoginBtn.classList.add("hidden");
Â  Â  Â  Â  addProductSection.classList.remove("hidden");
Â  Â  Â  } else {
Â  Â  Â  Â  userStatusDiv.textContent = "Logged out.";
Â  Â  Â  Â  logoutBtn.classList.add("hidden");
Â  Â  Â  Â  googleLoginBtn.classList.remove("hidden");
Â  Â  Â  Â  addProductSection.classList.add("hidden");
Â  Â  Â  }
Â  Â  Â  loadProducts();
Â  Â  });

Â  Â  // Function to load products from Supabase
Â  Â  const loadProducts = async (searchTerm = "") => {
Â  Â  Â  console.log("ğŸ”„ Loading products...");
Â  Â  Â  tableBody.innerHTML = '';
Â  Â  Â  try {
Â  Â  Â  Â  let query = supabase.from("products").select("*");

Â  Â  Â  Â  if (searchTerm.trim() !== "") {
Â  Â  Â  Â  Â  query = query.eq("serial_number", searchTerm);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  query = query.order("serial_number", { ascending: true });
Â  Â  Â  Â  }

Â  Â  Â  Â  const { data: products, error } = await query;

Â  Â  Â  Â  if (error) throw error;

Â  Â  Â  Â  if (products.length === 0) {
Â  Â  Â  Â  Â  const row = tableBody.insertRow();
Â  Â  Â  Â  Â  const cell = row.insertCell(0);
Â  Â  Â  Â  Â  cell.colSpan = 4;
Â  Â  Â  Â  Â  cell.textContent = "No products found.";
Â  Â  Â  Â  Â  cell.style.textAlign = "center";
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  products.forEach((product) => {
Â  Â  Â  Â  Â  const newRow = createProductRow(product);
Â  Â  Â  Â  Â  tableBody.appendChild(newRow);
Â  Â  Â  Â  });
Â  Â  Â  Â  console.log("âœ… Products loaded!");
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("âŒ Error loading products:", error);
Â  Â  Â  Â  alert("Error loading products. Check console.");
Â  Â  Â  }
Â  Â  };

Â  Â  // Helper function to create a table row
Â  Â  const createProductRow = (product) => {
Â  Â  Â  const row = document.createElement("tr");

Â  Â  Â  const serialCell = document.createElement("td");
Â  Â  Â  serialCell.textContent = product.serial_number;
Â  Â  Â  row.appendChild(serialCell);

Â  Â  Â  const imageCell = document.createElement("td");
Â  Â  Â  const img = document.createElement("img");
Â  Â  Â  img.src = product.image_url || '';
Â  Â  Â  img.alt = `Product ${product.serial_number}`;
Â  Â  Â  imageCell.appendChild(img);
Â  Â  Â  row.appendChild(imageCell);

Â  Â  Â  const priceCell = document.createElement("td");
Â  Â  Â  priceCell.textContent = `â‚¦${product.price}`;
Â  Â  Â  row.appendChild(priceCell);

Â  Â  Â  const actionsCell = document.createElement("td");
Â  Â  Â  if (auth.currentUser) {
Â  Â  Â  Â  const deleteBtn = document.createElement("button");
Â  Â  Â  Â  deleteBtn.textContent = "Remove";
Â  Â  Â  Â  deleteBtn.classList.add("delete-btn");
Â  Â  Â  Â  deleteBtn.onclick = () => deleteProduct(product.id, product.image_url, product.serial_number);
Â  Â  Â  Â  actionsCell.appendChild(deleteBtn);
Â  Â  Â  }
Â  Â  Â  row.appendChild(actionsCell);

Â  Â  Â  return row;
Â  Â  };

Â  Â  // Function to delete a product from Supabase
Â  Â  const deleteProduct = async (id, imageUrl, serial) => {
Â  Â  Â  if (!auth.currentUser) {
Â  Â  Â  Â  alert("Please log in to delete a product.");
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (!confirm(`Are you sure you want to delete product ${serial}?`)) {
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  try {
Â  Â  Â  Â  // First, delete the product image from Supabase Storage
Â  Â  Â  Â  if (imageUrl) {
Â  Â  Â  Â  Â  // Extract the file path from the full URL
Â  Â  Â  Â  Â  const filePath = imageUrl.split('/').pop();
Â  Â  Â  Â  Â  const { data, error: storageError } = await supabase.storage.from("images").remove([filePath]);
Â  Â  Â  Â  Â  if (storageError) {
Â  Â  Â  Â  Â  Â  console.error("âŒ Error deleting image from storage:", storageError);
Â  Â  Â  Â  Â  Â  alert("Error deleting image from storage. Check console.");
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Then, delete the product entry from the Supabase database
Â  Â  Â  Â  const { error: dbError } = await supabase.from("products").delete().eq("id", id);
Â  Â  Â  Â  if (dbError) throw dbError;

Â  Â  Â  Â  alert("âœ… Product deleted!");
Â  Â  Â  Â  loadProducts(); // Refresh the product list
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("âŒ Error deleting product:", error);
Â  Â  Â  Â  alert("Error deleting product. Check console.");
Â  Â  Â  }
Â  Â  };

Â  Â  // Function to add a new product to Supabase
Â  Â  const addNewProduct = async (productData) => {
Â  Â  Â  if (!auth.currentUser) {
Â  Â  Â  Â  alert("Please log in to add a product.");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const fileInput = document.getElementById("newImage");
Â  Â  Â  const imageFile = fileInput.files[0];
Â  Â  Â  let imageUrl = null;
Â  Â  Â  let filePath = null;

Â  Â  Â  try {
Â  Â  Â  Â  if (imageFile) {
Â  Â  Â  Â  Â  // Create a unique file path
Â  Â  Â  Â  Â  const fileExtension = imageFile.name.split(".").pop();
Â  Â  Â  Â  Â  filePath = `${auth.currentUser.uid}/${Date.now()}.${fileExtension}`;

Â  Â  Â  Â  Â  // Upload the image to Supabase Storage
Â  Â  Â  Â  Â  const { error: uploadError } = await supabase.storage
Â  Â  Â  Â  Â  Â  .from(BUCKET_NAME)
Â  Â  Â  Â  Â  Â  .upload(filePath, imageFile);

Â  Â  Â  Â  Â  if (uploadError) throw uploadError;

Â  Â  Â  Â  Â  // Get the public URL for the uploaded image
Â  Â  Â  Â  Â  const { data: publicUrlData } = supabase.storage
Â  Â  Â  Â  Â  Â  .from(BUCKET_NAME)
Â  Â  Â  Â  Â  Â  .getPublicUrl(filePath);

Â  Â  Â  Â  Â  imageUrl = publicUrlData.publicUrl;
Â  Â  Â  Â  }

Â  Â  Â  Â  const { error: insertError } = await supabase.from("products").insert([
Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  image_url: imageUrl,
Â  Â  Â  Â  Â  Â  serial_number: productData.serial_number,
Â  Â  Â  Â  Â  Â  price: productData.price,
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  ]);

Â  Â  Â  Â  if (insertError) throw insertError;

Â  Â  Â  Â  alert("âœ… Product added successfully!");
Â  Â  Â  Â  loadProducts(); // Refresh the list after adding a new product
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("âŒ Error adding product:", error);
Â  Â  Â  Â  alert(`âŒ Error adding product: ${error.message}`);
Â  Â  Â  }
Â  Â  };
</script>
